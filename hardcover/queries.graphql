fragment EditionInfo on editions {
  id
  title
  subtitle
  asin
  isbn_13
  edition_format
  pages
  audio_seconds
  language {
    code3
  }
  publisher {
    name
  }
  release_date
  audio_seconds
  physical_format
  physical_information
  edition_information
  users_read_count
  book_id
  score
}

fragment DefaultEditions on books {
  default_cover_edition_id
  default_ebook_edition_id
  default_audio_edition_id
  default_physical_edition_id
}

fragment WorkInfo on books {
  id
  title
  subtitle
  description
  release_date
  cached_tags(path: "$.Genre")
  cached_image(path: "url")
  contributions {
    author {
      ...AuthorInfo
    }
  }
  slug
  book_series {
    position
    series {
      id
      name
      description
      identifiers
    }
  }
  rating
  ratings_count: reviews_count
  ...DefaultEditions
}

fragment AuthorInfo on authors {
  id
  name
  slug
  bio
  cached_image(path: "url")
}

query GetWork($bookID: Int!) {
  books_by_pk(id: $bookID) {
    ...WorkInfo
    editions(order_by: { score: desc_nulls_last }) {
      ...EditionInfo
    }
  }
}

query GetEdition($editionID: Int!) {
  editions_by_pk(id: $editionID) {
    ...EditionInfo
    book {
      ...WorkInfo
    }
  }
}

query GetAuthor($id: Int!) {
  authors_by_pk(id: $id) {
    location
    slug
  }
}

query GetAuthorEditions($id: Int!, $limit: Int!, $offset: Int!) {
  authors_by_pk(id: $id) {
    ...AuthorInfo
    contributions(
      limit: $limit
      offset: $offset
      order_by: { book: { ratings_count: desc } }
      where: { contributable_type: { _eq: "Book" } }
    ) {
      book {
        id
        title
        ratings_count
        ...DefaultEditions
      }
    }
  }
}

query Search($query: String!) {
  search(
    query: $query
    per_page: 10
    query_type: "book"
    fields: "title,isbns,series_names,author_names,alternative_titles"
    weights: "5,1,3,5,1"
    sort: "ratings_count:desc,_text_match:desc"
  ) {
    ids
  }
}
